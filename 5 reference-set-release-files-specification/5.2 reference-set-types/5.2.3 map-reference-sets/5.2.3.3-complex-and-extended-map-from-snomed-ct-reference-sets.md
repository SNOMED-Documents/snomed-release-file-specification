# Complex and Extended Map from SNOMED CT Reference Sets

## Purpose

A [447250001 |Complex map from SNOMED CT type reference set|](http://snomed.info/id/447250001) supports the representation of maps where each SNOMED CT concept may map to one or more codes in a target scheme. This type of reference set supports the general set of mapping data required to enable a target code to be selected at run-time from a number of alternate codes. It supports target code selection by accommodating the inclusion of machine readable rules and/or human readable advice. An [609331003 |Extended map from SNOMED CT type reference set|](http://snomed.info/id/609331003) adds an additional field to allow the categorization of maps.

## Data structure

A [447250001 |Complex map from SNOMED CT type reference set|](http://snomed.info/id/447250001) is an Integer - Integer - String - String - String - Component reference set. The pattern is currently used for the map to ICD-9-CM. Its structure is as shown in the following table, with one exception - the table below includes an additional field (mapCategoryId) which is not used for this type of map.

An [609331003 |Extended map type reference set (foundation metadata concept)|](http://snomed.info/id/609331003) follows the same pattern but adds one additional column. It is an Integer - Integer - String - String - String - Component - Component reference set and this pattern is currently used for maps to ICD-10. Its structure is shown in the following table, and includes the mapCategoryId.

Table 5.2.3.3-1: Complex and Extended map from SNOMED CT type reference sets - Data structures

<table data-header-hidden data-full-width="true"><thead><tr><th width="208.015625"></th><th width="94.0859375"></th><th width="252.32421875"></th><th width="89.25390625"></th><th width="144.0390625"></th></tr></thead><tbody><tr><td><strong>Field</strong></td><td><strong>Data type</strong></td><td><strong>Purpose</strong></td><td><strong>Mutable</strong></td><td><strong>Part of Primary Key</strong></td></tr><tr><td>id</td><td>UUID</td><td><p>A 128 bit unsigned Integer, uniquely identifying this reference set member.</p><p>Different versions of a <em>reference set member</em> share the same id but have different effectiveTime. This allows a <em>reference set member</em> to be modified or made inactive (i.e. removed from the active set) at a specified time.</p></td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$success;">YES</mark> <br>(Full /Snapshot)</td></tr><tr><td>effectiveTime</td><td>Time</td><td><p>The inclusive date or time at which this version of the identified reference set member became the current version.</p><p><strong>Note</strong>: In distribution files the effectiveTime should follow the short ISO date format (<em>YYYYMMDD</em>) and should not include the hours, minutes, seconds or timezone indicator.</p><p>The current version of this reference set member at time <em>T</em> is the version with the most recent effectiveTime prior to or equal to time <em>T</em>.</p></td><td><mark style="color:$success;">YES</mark> </td><td><p><mark style="color:$success;">YES</mark> <br>(Full)</p><p><mark style="color:$success;">Optional</mark> (Snapshot) </p></td></tr><tr><td>active</td><td>Boolean</td><td><p>The state of the identified reference set member as at the specified effectiveTime .</p><p>If active = 1 (true) the reference set member is part of the current version of the set, if active = 0 (false) the reference set member is not part of the current version of the set.</p></td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>moduleId</td><td>SCTID</td><td><p>Identifies the SNOMED CT module that contains this reference set member as at the specified effectiveTime.</p><p>The value must be a subtype of <a href="http://snomed.info/id/900000000000443000">900000000000443000 |Module (core metadata concept)|</a> within the metadata hierarchy.</p></td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>refsetId</td><td>SCTID</td><td><p>Identifies the reference set to which this reference set member belongs.</p><p>In this case, a subtype descendant of: <a href="http://snomed.info/id/447250001">447250001 |Complex map from SNOMED CT type reference set|</a>  or <a href="http://snomed.info/id/609331003">609331003 |Extended map from SNOMED CT type reference set|</a></p></td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>referencedComponentId</td><td>SCTID</td><td><p>A reference to the SNOMED CT component to be included in the reference set.</p><p>Refers to the SNOMED CT concept that is mapped to the other terminology or code system (i.e. the map source).</p></td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>mapGroup</td><td>Integer</td><td>An Integer, grouping a set of complex map records from which one may be selected as a target code. Where a SNOMED CT concept maps onto 'n' target codes, there will be 'n' groups, each containing one or more complex map records.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>mapPriority</td><td>Integer</td><td>Within a mapGroup, the mapPriority specifies the order in which complex map records should be checked. Only the first map record meeting the run - time selection criteria will be taken as the target code within the group of alternate codes.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>mapRule</td><td>String</td><td>A machine-readable rule, (evaluating to either 'true' or 'false' at run-time) that indicates whether this map record should be selected within its mapGroup.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>mapAdvice</td><td>String</td><td>Human-readable advice, that may be employed by the software vendor to give an end-user advice on selection of the appropriate target code from the alternatives presented to him within the group.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>mapTarget</td><td>String</td><td>The target code in the target terminology, classification or code system.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>correlationId</td><td>SCTID</td><td>A child of <a href="http://snomed.info/id/1193546000">1193546000 |Map source to map target correlation (foundation metadata concept)|</a>  in the metadata hierarchy, identifying the correlation between the SNOMED CT concept and the target code.</td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td><em>The following additional field only applies to</em> <a href="http://snomed.info/id/609331003"><em>609331003 |Extended map type reference set|</em></a></td><td></td><td></td><td></td><td></td></tr><tr><td>mapCategoryId</td><td>SCTID</td><td><p>Identifies the SNOMED CT concept in the metadata hierarchy which represents the MapCategory for the associated map member. The categories vary for different target code systems, each set of categories is represented by a subtype of <a href="http://snomed.info/id/609330002">609330002 |Map category value|</a> .</p><p>In the case of ICD-10 the individual category values are <a href="https://confluence.ihtsdotools.org/display/DOCGLOSS/subtype">subtypes</a> of: <a href="http://snomed.info/id/447634004">447634004 |ICD-10 map category value|</a> .</p></td><td><mark style="color:$success;">YES</mark> </td><td><mark style="color:$danger;">NO</mark></td></tr></tbody></table>

## **Map Group, Priority and Rules**

Values for [mapGroup](../../../appendices/appendix-b.-specification-reference-information/m/mapgroup-field.md) are allocated on a sequential basis (for each refsetId and referencedComponentId combination) during authoring starting at 1. However, distributed mapGroup are not necessarily sequential, as some mapGroup may be created and removed during a mapping process between releases. For maps where each SNOMED CT concept only maps to at most one of a group of alternate target codes, the mapGroup field are usually be set to '1'.

Values for [mapPriority](../../../appendices/appendix-b.-specification-reference-information/m/mappriority-field.md) will be allocated on a sequential basis (within each map group) starting from '1'. For maps that do not require run - time alternatives, the mapPriority field is set to '1'.

The [mapRule](../../../appendices/appendix-b.-specification-reference-information/m/maprule-field.md) and [mapAdvice](../../../appendices/appendix-b.-specification-reference-information/m/mapadvice-field.md) fields enable run-time selection (within vendor's software) from a number of alternative map records within a mapGroup. Where there are no alternatives maps these columns of the release files will be empty (zero length string). Where alternative maps exist one or both of columns will be populated where relevant information is available.

Where both fields are populated, and a vendor's system is capable of processing a machine readable rule, this should take priority over the human readable advice. Where neither field is populated, a vendor's system should allow the end-user to select the appropriate target code from the alternates.

For more details on this topic in relation to the ICD-10 maps released as part of the SNOMED CT International Edition please see the [ICD-10 Mapping Technical Guide](https://app.gitbook.com/o/h8Z6qGxuQrzM9vbx5bPT/s/WdB6Is6LaDpXsfaSDN39/).

## Mapping Rule Specifications

The specific grammar and content of the rules for resolving complex mapping cases depends on the nature of the target code system or classification. In general, each map is accompanied by a rule which is tested against other data and can be evaluated to return one of the following values:

* **True** - in which case the map target applies;
* **False** - in which case the map target does not apply;
* **Indeterminate** - in cases where there is insufficient accessible data to determine whether the map target applies. In this case manual resolution of the map using the map advice provided will be required.

The mapping rules assume access to a number of variables, that can be bound to appropriate attributes in the vendor's system information model. These include the age and gender of the patient and information about coexisting situations (e.g. records of other disorders, procedures or events in the same patient record).

Detailed definitions of the mapping rules used forms part of individual specifications for maps to particular target code systems and classifications. This will initially be provided separately and will accompany the release of the relevant mapping files. For example, the set of rules used for mapping to ICD-10 are included in the [ICD-10 Mapping Technical Guide](https://app.gitbook.com/o/h8Z6qGxuQrzM9vbx5bPT/s/WdB6Is6LaDpXsfaSDN39/).

## Metadata

The following metadata supports this [reference set](https://confluence.ihtsdotools.org/display/DOCGLOSS/reference+set):

Table 5.2.3.3-2: Complex and Extended Map from SNOMED CT References Sets in the Metadata Hierarchy

[900000000000454005 |Foundation metadata concept|](http://snomed.info/id/900000000000454005)\
[900000000000455006 |Reference set|](http://snomed.info/id/900000000000455006)\
[447250001 |Complex map from SNOMED CT type reference set|](http://snomed.info/id/447250001)\
[609331003 |Extended map from SNOMED CT type reference set|](http://snomed.info/id/609331003)

## Reference Set Descriptor and Example Data

### Descriptor Templates

The tables below examples of the descriptors for specific [reference sets](https://confluence.ihtsdotools.org/display/DOCGLOSS/reference+set) that follow the [447250001 | Complex map type reference set|](http://snomed.info/id/447250001) and [609331003 | Extended map type reference set|](http://snomed.info/id/609331003) patterns.

Table 5.2.3.3-3: Refset Descriptor Rows for a Complex Map from SNOMED CT Reference Set

| **refsetId**          | **referencedComponentId (Referenced component)** | **attributeDescription (Attribute description)**                | **attributeType (Attribute type)** | **attributeOrder (Attribute order)** |
| --------------------- | ------------------------------------------------ | --------------------------------------------------------------- | ---------------------------------- | ------------------------------------ |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |

Table 5.2.3.3-4: Refset Descriptor Rows for an Extended Map from SNOMED CT type Reference Set

| **refsetId**          | **referencedComponentId (Referenced component)** | **attributeDescription (Attribute description)**                | **attributeType (Attribute type)** | **attributeOrder (Attribute order)** |
| --------------------- | ------------------------------------------------ | --------------------------------------------------------------- | ---------------------------------- | ------------------------------------ |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |
| \[ 900000000000456007 | Reference set descriptor                         | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor           | ")                                   |

### Example Data

Table 5.2.3.3-5: Sample Content from an Extended Map from SNOMED CT Reference Set

| **refSetId**                               | **referencedComponentId (Map source)**     | **mapGroup (Map group)**                      | **mapPriority (Map priority)**                                     | **mapRule (Map rule)**                        | **mapAdvice (Map advice)**                                         | **mapTarget (Map target)**                                 | **correlationId (Map source to map target correlation)** | **mapCategoryId (Map category)**                           |
| ------------------------------------------ | ------------------------------------------ | --------------------------------------------- | ------------------------------------------------------------------ | --------------------------------------------- | ------------------------------------------------------------------ | ---------------------------------------------------------- | -------------------------------------------------------- | ---------------------------------------------------------- |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 127009                                                          | Miscarriage with laceration of cervix                      | ]\(http://snomed.info/id/127009 "127009                  | Miscarriage with laceration of cervix                      |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 127009                                                          | Miscarriage with laceration of cervix                      | ]\(http://snomed.info/id/127009 "127009                  | Miscarriage with laceration of cervix                      |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 140004                                                          | Chronic pharyngitis                                        | ]\(http://snomed.info/id/140004 "140004                  | Chronic pharyngitis                                        |
| MAP OF SOURCE CONCEPT IS CONTEXT DEPENDENT | J35.0                                      | \[ 447561005                                  | SNOMED CT source code to target map code correlation not specified | ]\(http://snomed.info/id/447561005 "447561005 | SNOMED CT source code to target map code correlation not specified | ")                                                         | \[ 447639009                                             | Map of source concept is context dependent                 |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 140004                                                          | Chronic pharyngitis                                        | ]\(http://snomed.info/id/140004 "140004                  | Chronic pharyngitis                                        |
| MAP OF SOURCE CONCEPT IS CONTEXT DEPENDENT | B37.8                                      | \[ 447561005                                  | SNOMED CT source code to target map code correlation not specified | ]\(http://snomed.info/id/447561005 "447561005 | SNOMED CT source code to target map code correlation not specified | ")                                                         |                                                          |                                                            |
| \[ 447639009                               | Map of source concept is context dependent | ]\(http://snomed.info/id/447639009 "447639009 | Map of source concept is context dependent                         | ")                                            |                                                                    |                                                            |                                                          |                                                            |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 140004                                                          | Chronic pharyngitis                                        | ]\(http://snomed.info/id/140004 "140004                  | Chronic pharyngitis                                        |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 162004                                                          | Severe manic bipolar I disorder without psychotic features | ]\(http://snomed.info/id/162004 "162004                  | Severe manic bipolar I disorder without psychotic features |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 177007                                                          | Poisoning by sawfly larvae                                 | ]\(http://snomed.info/id/177007 "177007                  | Poisoning by sawfly larvae                                 |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 177007                                                          | Poisoning by sawfly larvae                                 | ]\(http://snomed.info/id/177007 "177007                  | Poisoning by sawfly larvae                                 |
| \[ 447637006                               | Map source concept is properly classified  | ]\(http://snomed.info/id/447637006 "447637006 | Map source concept is properly classified                          | ")                                            |                                                                    |                                                            |                                                          |                                                            |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 181007                                                          | Hemorrhagic bronchopneumonia                               | ]\(http://snomed.info/id/181007 "181007                  | Hemorrhagic bronchopneumonia                               |
| \[ 447562003                               | ICD-10 complex map reference set           | ]\(http://snomed.info/id/447562003 "447562003 | ICD-10 complex map reference set                                   | ")                                            | \[ 183005                                                          | Autoimmune pancytopenia                                    | ]\(http://snomed.info/id/183005 "183005                  | Autoimmune pancytopenia                                    |

## Related Links

* [ICD-10 Mapping Technical Guide](https://confluence.ihtsdotools.org/display/DOCICD10/ICD-10+Mapping+Technical+Guide)
