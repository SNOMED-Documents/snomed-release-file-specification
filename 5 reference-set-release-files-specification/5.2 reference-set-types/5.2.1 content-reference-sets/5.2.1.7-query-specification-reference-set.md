# Query Specification Reference Set

## Purpose

A [900000000000512005 | Query specification type reference set|](http://snomed.info/id/900000000000512005) allows a serialised query to represent the membership of a subset of SNOMED CT components. A query contained in the reference set is run against the content of SNOMED CT to produce a subset of concepts, descriptions or relationships. The query is referred to an intensional definition of the subset. It can be run against future releases of SNOMED CT to generate an updated set of subset members.

The members of the resulting subset may also be represented in an enumerated form as a Simple reference set. An enumerated representation of a subset is referred to as an extensional definition.

## Data structure

A Query Specification Reference Set is a String reference set containing query that represent intensional definitions of subsets of components. The result of running the query is an extensional representation of the subset of components which can be represented as a Simple Reference Set. Its structure is shown in the following table.

Table 5.2.1.7-1: Query specification reference set - Data structure

<table data-header-hidden data-full-width="true"><thead><tr><th width="208.56640625"></th><th width="99.15234375"></th><th width="303.1640625"></th><th width="89.484375"></th><th></th></tr></thead><tbody><tr><td><strong>Field</strong></td><td><strong>Data type</strong></td><td><strong>Purpose</strong></td><td><strong>Mutable</strong></td><td><strong>Part of Primary Key</strong></td></tr><tr><td>id</td><td>UUID</td><td>A 128 bit unsigned Integer, uniquely identifying this reference set member.Different versions of a <em>reference set member</em> share the same id but have different effectiveTime. This allows a <em>reference set member</em> to be modified or made inactive (i.e. removed from the active set) at a specified time.</td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$success;">YES</mark><br>(Full/Snapshot)</td></tr><tr><td>effectiveTime</td><td>Time</td><td><p>The inclusive date or time at which this version of the identified reference set member became the current version.</p><p><strong>Note</strong> : In distribution files the effectiveTime should follow the short ISO date format (<em>YYYYMM DD</em>) and should not include the hours, minutes, seconds or timezone indicator.The current version of this reference set member at time <em>T</em> is the version with the most recent effectiveTime prior to or equal to time <em>T</em>.</p></td><td><mark style="color:$success;">YES</mark></td><td><mark style="color:$success;">YES</mark> <br>(Full)<br><mark style="color:$success;">Optional</mark> (Snapshot)</td></tr><tr><td>active</td><td>Boolean</td><td>The state of the identified reference set member as at the specified effectiveTime. If active = 1 (true) the reference set member is part of the current version of the set, if active = 0 (false) the reference set member is not part of the current version of the set.</td><td><mark style="color:$success;">YES</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>moduleId</td><td>SCTID</td><td><p>Identifies the SNOMED CT module that contains this reference set member as at the specified effectiveTime .</p><p>The value must be a subtype of <a href="http://snomed.info/id/900000000000443000">900000000000443000 |Module (core metadata concept)|</a> within the metadata hierarchy.</p></td><td><mark style="color:$success;">YES</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>refsetId</td><td>SCTID</td><td><p>Identifies the reference set to which this reference set member belongs.</p><p>A subtype descendant of:</p><p><a href="http://snomed.info/id/900000000000512005">900000000000512005 | Query specification type|</a></p></td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>referencedComponentId</td><td>SCTID</td><td>A reference to the SNOMED CT component to be included in the reference set.</td><td><mark style="color:$danger;">NO</mark></td><td><mark style="color:$danger;">NO</mark></td></tr><tr><td>query</td><td>String</td><td><p></p><p>The serialised query that can be used to (re-)generate the reference set members.</p><ul><li>The syntax for specifying the intensional definitions of concept subsets is specified in the <a href="https://app.gitbook.com/o/h8Z6qGxuQrzM9vbx5bPT/s/sOJBD7YbxAy9bD1Ko9L9/">Expression Constraint Language - Specification and Guide.</a></li></ul></td><td><mark style="color:$success;">YES</mark></td><td><mark style="color:$danger;">NO</mark></td></tr></tbody></table>

## Metadata

The following metadata in the "Foundation metadata [concept](https://confluence.ihtsdotools.org/display/DOCGLOSS/concept) " [hierarchy](https://confluence.ihtsdotools.org/display/DOCGLOSS/hierarchy) supports this [reference set](https://confluence.ihtsdotools.org/display/DOCGLOSS/reference+set) :

Table 5.2.1.7-2: Hierarchy of Foundation metadata concept

[900000000000454005 |Foundation metadata concept|](http://snomed.info/id/900000000000454005)\
[900000000000455006 |Reference set|](http://snomed.info/id/900000000000455006)\
[900000000000512005 |Query specification type|](http://snomed.info/id/900000000000512005)\
[900000000000513000 |Simple query specification|](http://snomed.info/id/900000000000513000)

## Reference Set Descriptor and Example Data

### Descriptor Template

The table below shows the descriptor that defines the structure of the [900000000000512005 | Query specification type reference set|](http://snomed.info/id/900000000000512005) pattern.

Table 5.2.1.7-3: Descriptor Template for Query Specification Reference Sets

| **refsetId**          | **referencedComponentId** | **attributeDescription**                                        | **attributeType**        | **attributeOrder** |
| --------------------- | ------------------------- | --------------------------------------------------------------- | ------------------------ | ------------------ |
| \[ 900000000000456007 | Reference set descriptor  | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor | ")                 |
| \[ 900000000000456007 | Reference set descriptor  | ]\(http://snomed.info/id/900000000000456007 "900000000000456007 | Reference set descriptor | ")                 |

### Example Data

In the example below, "serialised [query](https://confluence.ihtsdotools.org/display/WIPRELFMT/query+\(field\)) 1" is a text [string](https://confluence.ihtsdotools.org/display/WIPRELFMT/String+\(data+type\)) that can be used to generate members for [_Reference set_](https://confluence.ihtsdotools.org/display/DOCGLOSS/Reference+set) _1_ , which is a simple member [reference set](https://confluence.ihtsdotools.org/display/DOCGLOSS/reference+set) (without any additional fields within its member records).

Table 5.2.1.7-4: Example rows from Query Specification Reference Set

| **refsetId**          | **referencedComponentId**  | **query**                                                       |
| --------------------- | -------------------------- | --------------------------------------------------------------- |
| \[ 900000000000513000 | Simple query specification | ]\(http://snomed.info/id/900000000000513000 "900000000000513000 |

## References

* See [Expression Constraint Language - Specification and Guide](https://confluence.ihtsdotools.org/display/DOCECL/Expression+Constraint+Language+-+Specification+and+Guide) for details of the language used to specify intensional definitions of concept subsets.
